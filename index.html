<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Training Selector</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }

  h2 {
    margin-bottom: 15px;
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
  }

  .wrapper {
    display: flex;
    align-items: stretch;
    gap: 40px;
    flex-direction: row;
    justify-content: flex-start;
  }

  .controls {
    display: flex;
    flex-direction: column;
  }

  select {
    padding: 8px;
    margin: 5px 0;
    border-radius: 5px;
    border: 2px solid #ccc;
    font-size: 14px;
    min-width: 220px;
    accent-color: #b91e71;
  }

  select:focus {
    outline: none;
    border-color: #b91e71;
    box-shadow: 0 0 5px rgba(185, 30, 113, 0.4);
  }

  button {
    padding: 8px 15px;
    margin-top: 10px;
    background-color: #b91e71;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    width:60%;
  }

  button:hover {
    opacity: 0.9;
  }

  .logo {
    max-height: 95px;
  }
</style>
</head>

<body>

<h2>Training Selector</h2>

<div class="wrapper">

  <div class="controls">

    <!-- Department -->
    <select id="departmentSelect">
      <option value="">Loading departmentsâ€¦</option>
    </select>

    <!-- Role -->
    <select id="roleSelect" disabled>
      <option value="">Select department first</option>
    </select>

    <button onclick="goToTraining()">Go to training</button>

  </div>

  <img src="logo.png" class="logo" alt="Digital Learning team logo">

</div>

<script>
let rolesData = [];

fetch('roles.csv')
  .then(response => response.text())
  .then(text => {

    const rows = text.trim().split('\n').slice(1);

    rolesData = rows.map(row => {
      const cols = row.split(',');
      return {
        department: cols[0].trim(),
        role: cols[1].trim(),
        url: cols[2].trim()
      };
    });

    populateDepartments();
  });

function populateDepartments() {
  const deptSelect = document.getElementById('departmentSelect');

  const departments = [...new Set(rolesData.map(r => r.department))];

  deptSelect.innerHTML = '<option value="">-- Choose department --</option>';

  departments.forEach(dept => {
    const option = document.createElement('option');
    option.value = dept;
    option.textContent = dept;
    deptSelect.appendChild(option);
  });
}

document.getElementById('departmentSelect').addEventListener('change', function() {

  const selectedDept = this.value;
  const roleSelect = document.getElementById('roleSelect');

  roleSelect.innerHTML = '<option value="">-- Choose role --</option>';
  roleSelect.disabled = !selectedDept;

  const filteredRoles = rolesData.filter(r => r.department === selectedDept);

  filteredRoles.forEach(r => {
    const option = document.createElement('option');
    option.value = r.url;
    option.textContent = r.role;
    roleSelect.appendChild(option);
  });

});

function goToTraining() {
  const url = document.getElementById('roleSelect').value;

  if (!url) {
    alert('Please select a role');
    return;
  }

  window.open(url, '_blank');
}
</script>

</body>
</html>
